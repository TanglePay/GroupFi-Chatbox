<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Trollbox SDK Demo</title>
    <link rel="stylesheet" href="./dist/iife/assets/style.css" />
  </head>
  <body>
    <h1>Test GroupFi Trollbox Iframe</h1>
    <h2>Trollbox version is <span id="version">-</span></h2>

    <h2>You just sent a message: <a id="message" target="_blank"></a></h2>

    <button id="tanglepay-btn">Connect TanglePay wallet</button>
    <button id="disconnect-btn">Disconnect the wallet</button>
    <style></style>
    <script>
      const script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = `./dist/iife/index.js?timestamp=${Date.now()}`;
      document.body.appendChild(script);

      const messageContainer = document.getElementById('message');

      const tanglepayBtnDom = document.getElementById('tanglepay-btn');

      const disconnectBtnDom = document.getElementById('disconnect-btn');

      script.onload = function () {
        console.log('====>TrollboxSDK', window.trollbox);

        tanglepayBtnDom.addEventListener('click', function () {
          trollbox.loadTrollbox();
          tanglepayBtnDom.innerText = 'wallet connected'
        });

        disconnectBtnDom.addEventListener('click', function () {
          trollbox.removeTrollbox()
          // trollbox.dispatchWalletChange({
          //   walletType: undefined,
          // });
          tanglepayBtnDom.innerText = 'Connect TanglePay Wallet';
        });
      };

      window.addEventListener('trollbox-ready', function (data) {
        trollbox.dispatchWalletUpdate({
            walletType: 'tanglepay',
          });
      })

      // window.addEventListener('trollbox-ready', function (data) {
      // const versionDom = document.getElementById('version');
      // versionDom.innerText = trollbox.trollboxVersion;

      // trollbox.on('one-message-sent', (data) => {
      //   const { message, blockId } = data;
      //   messageContainer.href = `https://explorer.shimmer.network/shimmer/block/${blockId}`;
      //   messageContainer.innerText = message;
      // });

      // trollbox.on('wallet-connected-changed', (data) => {
      //   console.log('wallet-connected-changed', data);
      // });

      // trollbox
      //   .request({
      //     method: 'setForMeGroups',
      //     params: {
      //       includes: ['smr', 'staff-developer'],
      //     },
      //     // params: {
      //     //   excludes: ['alpha-test'],
      //     // },
      //   })
      //   .then((res) => {
      //     console.log('setForMeGroups res', res);
      //   });
      // });
    </script>
  </body>
</html>
